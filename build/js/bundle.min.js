!function(e,i){var t=function(e){return new t.init(e)};t.prototype={verticalSwiper:{},initSwipers:function(){new Swiper(".header-slider .swiper-container",{loop:!0,speed:400,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",slidesPerView:4,breakpoints:{768:{slidesPerView:2},414:{slidesPerView:1}}});this.checkMedia("(min-width: 414px)")&&(this.verticalSwiper=new Swiper(".vertical-slider .swiper-container",{pagination:".swiper-pagination",direction:"vertical",slidesPerView:1,paginationClickable:!0,onlyExternal:!0}));new Swiper(".bottom-slider .swiper-container",{slidesPerView:2.5,spaceBetween:30,slidesOffsetBefore:150,slidesOffsetAfter:150,grabCursor:!0,breakpoints:{1439:{slidesPerView:"auto",slidesOffsetBefore:30,slidesOffsetAfter:30},768:{slidesPerView:1.25,spaceBetween:25,slidesOffsetBefore:20,slidesOffsetAfter:20},414:{slidesPerView:1.25,spaceBetween:25,slidesOffsetBefore:20,slidesOffsetAfter:20}}})},initTabs:function(e){(e=e||i(".custom-tabs")).on("click",function(e){var t=i(e.target);if(that=this,i(t).is(".tab-link")){var n=t.data("open"),o=i(that).find(".tab-content"),r=i(that).find(".tab-link"),s=i(t);o.hide(),r.removeClass("active"),s.addClass("active"),i("#"+n).show()}})},preventDefault:function(e){(e=e||window.event).preventDefault&&e.preventDefault(),e.returnValue=!1},preventDefaultForScrollKeys:function(e){if(keys[e.keyCode])return preventDefault(e),!1},disableScroll:function(){var e=this;window.addEventListener&&window.addEventListener("DOMMouseScroll",e.preventDefault,!1),window.onwheel=e.preventDefault,window.onmousewheel=document.onmousewheel=e.preventDefault,window.ontouchmove=e.preventDefault,document.onkeydown=e.preventDefaultForScrollKeys},enableScroll:function(){var e=this;window.removeEventListener&&window.removeEventListener("DOMMouseScroll",e.preventDefault,!1),window.onmousewheel=document.onmousewheel=null,window.onwheel=null,window.ontouchmove=null,document.onkeydown=null},fixBody:function(){i("html").add("body").addClass("fixBody")},unfixBody:function(){i("html").add("body").removeClass("fixBody")},checkMedia:function(e){return window.matchMedia(e).matches},scroll:function(e,t){i("html, body").animate({scrollTop:i(e).offset().top-100},t)},openPopUp:function(e){i(e).show()},closePopUp:function(e){i(e).hide()},initPopUps:function(){var e=this;i(".triger-pop-up").on("click",function(t){if(i(this).data("target")){var n=i(this).data("target");"#mobile-navigation"!==n?(i(".cross").show(),e.openPopUp(n),e.fixBody()):(i(".cross.inner").show(),e.openPopUp(n),e.fixBody(),e.disableScroll())}}),i(".cross").on("click",function(){e.closePopUp(".pop-up"),i(".cross").hide(),e.unfixBody(),e.enableScroll()})},initStickyHeader:function(){var e=i("#sticky-header"),t=new ScrollMagic.Controller({globalSceneOptions:{triggerHook:"onLeave"}});new ScrollMagic.Scene({triggerElement:"#initSticky",duration:1}).addTo(t).on("enter",function(i){"FORWARD"===i.target.controller().info("scrollDirection")?e.fadeIn(300):e.fadeOut(300)})},initHiddenGallery:function(){var e=i("a.show-more"),t=i(".col-hidden"),n=0;e.on("click",function(){t.toggle(),++n%2?i(this).text("Скрыть").addClass("opened"):i(this).text("Больше").removeClass("opened")})},initScroller:function(){var e,t=this;i(".scroll").on("click",function(n){"top"===(e=i(n.target).data("scrol-to"))?t.scroll("body",500):t.scroll("."+e,500)})},initPins:function(){function e(){n.fixBody(),setTimeout(function(){n.unfixBody(),t.unlockSwipes()},500)}var i,t=this.verticalSwiper,n=this,o=1,r=100,s=4200,l=this.checkMedia("(min-width: 1440px)");media1024=this.checkMedia("(min-width: 1024px) and (max-width: 1439px)"),tablet=this.checkMedia("(min-width: 768px) and (max-width: 1023px)"),mobile=this.checkMedia("(min-width: 320px) and (max-width: 767px)");var a=new ScrollMagic.Controller({globalSceneOptions:{triggerHook:"onLeave"}});if((l||tablet)&&(r=100,s=2200),media1024&&(r=120,s=2200),!mobile){t.on("onSlideChangeEnd",function(){t.lockSwipes()});new ScrollMagic.Scene({triggerElement:"#pin",duration:s,offset:-r}).addTo(a).setPin("#pin").on("enter",function(e){o="FORWARD"===e.target.controller().info("scrollDirection")?1:2}).on("progress",function(n){i=10*n.progress.toFixed(2),"FORWARD"===n.target.controller().info("scrollDirection")?i>3.5*o&&(t.slideNext(),o++,e()):i<3.5*o&&(t.slidePrev(),o--,e())})}},preloader:function(){function e(){var e=(100/s*(r+=1)<<0)+"%";if(o.css({width:e}),r===s)return t()}function t(){i(".preloader").addClass("zoomOut"),setTimeout(function(){i(".preloader").remove()},1e3)}i(".preloader");var n=i("img"),o=i(".preloader-status"),r=0,s=n.length;!function(){for(var i=0;i<s;i++){var t=new Image;t.onload=e,t.onerror=e,t.src=n[i].src}}()},initAllPlugins:function(){this.initSwipers(),this.initTabs(),this.initPopUps(),this.initHiddenGallery(),this.initScroller(),this.initStickyHeader()}},t.init=function(e){this.initAllPlugins()},t.init.prototype=t.prototype,e.bredek=e.BREDEK=t}(window,jQuery),$(document).ready(function(){var e=BREDEK();document.addEventListener("DOMContentLoaded",e.preloader(),!1),e.initPins()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZ2xvYmFsIiwiJCIsImJyZWRlayIsIm9wdGlvbnMiLCJpbml0IiwicHJvdG90eXBlIiwidmVydGljYWxTd2lwZXIiLCJpbml0U3dpcGVycyIsIlN3aXBlciIsImxvb3AiLCJzcGVlZCIsIm5leHRCdXR0b24iLCJwcmV2QnV0dG9uIiwic2xpZGVzUGVyVmlldyIsImJyZWFrcG9pbnRzIiwiNzY4IiwiNDE0IiwidGhpcyIsImNoZWNrTWVkaWEiLCJwYWdpbmF0aW9uIiwiZGlyZWN0aW9uIiwicGFnaW5hdGlvbkNsaWNrYWJsZSIsIm9ubHlFeHRlcm5hbCIsInNwYWNlQmV0d2VlbiIsInNsaWRlc09mZnNldEJlZm9yZSIsInNsaWRlc09mZnNldEFmdGVyIiwiZ3JhYkN1cnNvciIsIjE0MzkiLCJpbml0VGFicyIsInRhYnNDb250YWluZXIiLCJvbiIsImUiLCJjdCIsInRhcmdldCIsInRoYXQiLCJpcyIsIm9wZW5UYWIiLCJkYXRhIiwidGFicyIsImZpbmQiLCJ0YWJMaW5rcyIsImN1cnJlbnRMaW5rIiwiaGlkZSIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJzaG93IiwicHJldmVudERlZmF1bHQiLCJ3aW5kb3ciLCJldmVudCIsInJldHVyblZhbHVlIiwicHJldmVudERlZmF1bHRGb3JTY3JvbGxLZXlzIiwia2V5cyIsImtleUNvZGUiLCJkaXNhYmxlU2Nyb2xsIiwicGxnIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9ud2hlZWwiLCJvbm1vdXNld2hlZWwiLCJkb2N1bWVudCIsIm9udG91Y2htb3ZlIiwib25rZXlkb3duIiwiZW5hYmxlU2Nyb2xsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImZpeEJvZHkiLCJhZGQiLCJ1bmZpeEJvZHkiLCJyZXNvbHV0aW9uIiwibWF0Y2hNZWRpYSIsIm1hdGNoZXMiLCJzY3JvbGwiLCJzY3JvbGxUbyIsImFuaW1hdGUiLCJzY3JvbGxUb3AiLCJvZmZzZXQiLCJ0b3AiLCJvcGVuUG9wVXAiLCJwb3B1cFNlbGVjdG9yIiwiY2xvc2VQb3BVcCIsImluaXRQb3BVcHMiLCJ0IiwiaW5pdFN0aWNreUhlYWRlciIsImNvbnRyb2xsZXIiLCJTY3JvbGxNYWdpYyIsIkNvbnRyb2xsZXIiLCJnbG9iYWxTY2VuZU9wdGlvbnMiLCJ0cmlnZ2VySG9vayIsIlNjZW5lIiwidHJpZ2dlckVsZW1lbnQiLCJkdXJhdGlvbiIsImFkZFRvIiwiaW5mbyIsImZhZGVJbiIsImZhZGVPdXQiLCJpbml0SGlkZGVuR2FsbGVyeSIsImhpZGRlbkltYWdlcyIsImNsaWNrcyIsInRvZ2dsZSIsInRleHQiLCJpbml0U2Nyb2xsZXIiLCJpbml0UGlucyIsImRlbGF5Iiwic2V0VGltZW91dCIsInNsaWRlciIsInVubG9ja1N3aXBlcyIsInByb2dyZXNzIiwibXVsdGlwbGllciIsIm1lZGlhMTQ0MCIsIm1lZGlhMTAyNCIsInRhYmxldCIsIm1vYmlsZSIsImxvY2tTd2lwZXMiLCJzZXRQaW4iLCJ0b0ZpeGVkIiwic2xpZGVOZXh0Iiwic2xpZGVQcmV2IiwicHJlbG9hZGVyIiwiaW1nTG9hZGVkIiwicGVyYyIsInRvdCIsImMiLCJzdGF0dXMiLCJjc3MiLCJ3aWR0aCIsImRvbmVMb2FkaW5nIiwicmVtb3ZlIiwiaW1nIiwibGVuZ3RoIiwiaSIsInRJbWciLCJJbWFnZSIsIm9ubG9hZCIsIm9uZXJyb3IiLCJzcmMiLCJpbml0QWxsUGx1Z2lucyIsIkJSRURFSyIsImpRdWVyeSIsInJlYWR5Il0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxHQUdBLElBQUFDLEVBQUEsU0FBQUMsR0FDQSxPQUFBLElBQUFELEVBQUFFLEtBQUFELElBSUFELEVBQUFHLFdBQ0FDLGtCQUNBQyxZQUFBLFdBQ0EsSUFBQUMsT0FBQSxvQ0FDQUMsTUFBQSxFQUNBQyxNQUFBLElBQ0FDLFdBQUEsc0JBQ0FDLFdBQUEsc0JBQ0FDLGNBQUEsRUFDQUMsYUFDQUMsS0FDQUYsY0FBQSxHQUVBRyxLQUNBSCxjQUFBLE1BSUFJLEtBQUFDLFdBQUEsd0JBQ0FE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QUNBWCxLQUFBNkQsYUFDQTdELEtBQUE0RSxvQkFDQTVFLEtBQUFpRixlQUNBakYsS0FBQStELHFCQUtBOUUsRUFBQUUsS0FBQSxTQUFBRCxHQUNBYyxLQUNBb0gsa0JBR0FuSSxFQUFBRSxLQUFBQyxVQUFBSCxFQUFBRyxVQUNBTCxFQUFBRSxPQUFBRixFQUFBc0ksT0FBQXBJLEdBRUE2QyxPQUFBd0YsUUFHQXRJLEVBQUF5RCxVQUFBOEUsTUFBQSxXQUNBLElBQUFsRixFQUFBZ0YsU0FDQTVFLFNBQUFILGlCQUFBLG1CQUFBRCxFQUFBNkQsYUFBQSxHQUNBN0QsRUFBQTZDIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIjsgKGZ1bmN0aW9uIChnbG9iYWwsICQpIHtcblxuICAgIC8vICduZXcnIGFuIG9iamVjdFxuICAgIHZhciBicmVkZWsgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbmV3IGJyZWRlay5pbml0KG9wdGlvbnMpO1xuICAgIH1cblxuICAgIC8vIHByb3RvdHlwZSBob2xkcyBtZXRob2RzICh0byBzYXZlIG1lbW9yeSBzcGFjZSlcbiAgICBicmVkZWsucHJvdG90eXBlID0ge1xuICAgICAgICB2ZXJ0aWNhbFN3aXBlcjoge30sXG4gICAgICAgIGluaXRTd2lwZXJzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgc2ltcGxlU3dpcGVyID0gbmV3IFN3aXBlcignLmhlYWRlci1zbGlkZXIgLnN3aXBlci1jb250YWluZXInLCB7XG4gICAgICAgICAgICAgICAgbG9vcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzcGVlZDogNDAwLFxuICAgICAgICAgICAgICAgIG5leHRCdXR0b246ICcuc3dpcGVyLWJ1dHRvbi1uZXh0JyxcbiAgICAgICAgICAgICAgICBwcmV2QnV0dG9uOiAnLnN3aXBlci1idXR0b24tcHJldicsXG4gICAgICAgICAgICAgICAgc2xpZGVzUGVyVmlldzogNCxcbiAgICAgICAgICAgICAgICBicmVha3BvaW50czoge1xuICAgICAgICAgICAgICAgICAgICA3Njg6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlc1BlclZpZXc6IDJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgNDE0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNQZXJWaWV3OiAxXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja01lZGlhKFwiKG1pbi13aWR0aDogNDE0cHgpXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52ZXJ0aWNhbFN3aXBlciA9IG5ldyBTd2lwZXIoJy52ZXJ0aWNhbC1zbGlkZXIgLnN3aXBlci1jb250YWluZXInLCB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb246ICcuc3dpcGVyLXBhZ2luYXRpb24nLFxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICd2ZXJ0aWNhbCcsXG4gICAgICAgICAgICAgICAgICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25DbGlja2FibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG9ubHlFeHRlcm5hbDogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGJvdHRvbVN3aXBlciA9IG5ldyBTd2lwZXIoJy5ib3R0b20tc2xpZGVyIC5zd2lwZXItY29udGFpbmVyJywge1xuICAgICAgICAgICAgICAgIHNsaWRlc1BlclZpZXc6IDIuNSxcbiAgICAgICAgICAgICAgICBzcGFjZUJldHdlZW46IDMwLFxuICAgICAgICAgICAgICAgIHNsaWRlc09mZnNldEJlZm9yZTogMTUwLFxuICAgICAgICAgICAgICAgIHNsaWRlc09mZnNldEFmdGVyOiAxNTAsXG4gICAgICAgICAgICAgICAgZ3JhYkN1cnNvcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBicmVha3BvaW50czoge1xuICAgICAgICAgICAgICAgICAgICAxNDM5OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNQZXJWaWV3OiBcImF1dG9cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlc09mZnNldEJlZm9yZTogMzAsXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNPZmZzZXRBZnRlcjogMzAsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIDc2ODoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVzUGVyVmlldzogMS4yNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwYWNlQmV0d2VlbjogMjUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNPZmZzZXRCZWZvcmU6IDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVzT2Zmc2V0QWZ0ZXI6IDIwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIDQxNDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVzUGVyVmlldzogMS4yNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwYWNlQmV0d2VlbjogMjUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNPZmZzZXRCZWZvcmU6IDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVzT2Zmc2V0QWZ0ZXI6IDIwLFxuXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdFRhYnM6IGZ1bmN0aW9uICh0YWJzQ29udGFpbmVyKSB7XG4gICAgICAgICAgICB2YXIgdGFic0NvbnRhaW5lciA9IHRhYnNDb250YWluZXIgfHwgJCgnLmN1c3RvbS10YWJzJyk7XG4gICAgICAgICAgICB0YWJzQ29udGFpbmVyLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN0ID0gJChlLnRhcmdldClcbiAgICAgICAgICAgICAgICB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICAgICBpZiAoJChjdCkuaXMoJy50YWItbGluaycpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcGVuVGFiID0gY3QuZGF0YSgnb3BlbicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFicyA9ICQodGhhdCkuZmluZCgnLnRhYi1jb250ZW50JyksXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJMaW5rcyA9ICQodGhhdCkuZmluZCgnLnRhYi1saW5rJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluayA9ICQoY3QpO1xuICAgICAgICAgICAgICAgICAgICAvLyBoaWRlIGFsbCB0YWJzXG4gICAgICAgICAgICAgICAgICAgIHRhYnMuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICB0YWJMaW5rcy5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIHNob3cgb25seSBhY3RpdmVcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmsuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgICAgICQoXCIjXCIgKyBvcGVuVGFiKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcblxuICAgICAgICBwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcbiAgICAgICAgICAgIGlmIChlLnByZXZlbnREZWZhdWx0KVxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICBwcmV2ZW50RGVmYXVsdEZvclNjcm9sbEtleXM6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoa2V5c1tlLmtleUNvZGVdKSB7XG4gICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQoZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRpc2FibGVTY3JvbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBwbGcgPSB0aGlzO1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSAvLyBvbGRlciBGRlxuICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Nb3VzZVNjcm9sbCcsIHBsZy5wcmV2ZW50RGVmYXVsdCwgZmFsc2UpO1xuICAgICAgICAgICAgd2luZG93Lm9ud2hlZWwgPSBwbGcucHJldmVudERlZmF1bHQ7IC8vIG1vZGVybiBzdGFuZGFyZFxuICAgICAgICAgICAgd2luZG93Lm9ubW91c2V3aGVlbCA9IGRvY3VtZW50Lm9ubW91c2V3aGVlbCA9IHBsZy5wcmV2ZW50RGVmYXVsdDsgLy8gb2xkZXIgYnJvd3NlcnMsIElFXG4gICAgICAgICAgICB3aW5kb3cub250b3VjaG1vdmUgPSBwbGcucHJldmVudERlZmF1bHQ7IC8vIG1vYmlsZVxuICAgICAgICAgICAgZG9jdW1lbnQub25rZXlkb3duID0gcGxnLnByZXZlbnREZWZhdWx0Rm9yU2Nyb2xsS2V5cztcbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGVTY3JvbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBwbGcgPSB0aGlzO1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKVxuICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdET01Nb3VzZVNjcm9sbCcsIHBsZy5wcmV2ZW50RGVmYXVsdCwgZmFsc2UpO1xuICAgICAgICAgICAgd2luZG93Lm9ubW91c2V3aGVlbCA9IGRvY3VtZW50Lm9ubW91c2V3aGVlbCA9IG51bGw7XG4gICAgICAgICAgICB3aW5kb3cub253aGVlbCA9IG51bGw7XG4gICAgICAgICAgICB3aW5kb3cub250b3VjaG1vdmUgPSBudWxsO1xuICAgICAgICAgICAgZG9jdW1lbnQub25rZXlkb3duID0gbnVsbDtcbiAgICAgICAgfSxcblxuICAgICAgICBmaXhCb2R5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCdodG1sJylcbiAgICAgICAgICAgICAgICAuYWRkKCdib2R5JylcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2ZpeEJvZHknKTtcbiAgICAgICAgfSxcblxuICAgICAgICB1bmZpeEJvZHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoJ2h0bWwnKVxuICAgICAgICAgICAgICAgIC5hZGQoJ2JvZHknKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnZml4Qm9keScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoZWNrTWVkaWE6IGZ1bmN0aW9uIChyZXNvbHV0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gd2luZG93Lm1hdGNoTWVkaWEocmVzb2x1dGlvbikubWF0Y2hlcztcbiAgICAgICAgfSxcblxuICAgICAgICBzY3JvbGw6IGZ1bmN0aW9uIChzY3JvbGxUbywgc3BlZWQpIHtcbiAgICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBzY3JvbGxUb3A6ICQoc2Nyb2xsVG8pLm9mZnNldCgpLnRvcCAtIDEwMFxuICAgICAgICAgICAgfSwgc3BlZWQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9wZW5Qb3BVcDogZnVuY3Rpb24gKHBvcHVwU2VsZWN0b3IpIHtcbiAgICAgICAgICAgICQocG9wdXBTZWxlY3Rvcikuc2hvdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsb3NlUG9wVXA6IGZ1bmN0aW9uIChwb3B1cFNlbGVjdG9yKSB7XG4gICAgICAgICAgICAkKHBvcHVwU2VsZWN0b3IpLmhpZGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0UG9wVXBzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcGxnID0gdGhpcztcbiAgICAgICAgICAgICQoJy50cmlnZXItcG9wLXVwJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5kYXRhKCd0YXJnZXQnKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdCA9ICQodGhpcykuZGF0YSgndGFyZ2V0Jyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICE9PSBcIiNtb2JpbGUtbmF2aWdhdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuY3Jvc3MnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbGcub3BlblBvcFVwKHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGxnLmZpeEJvZHkoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5jcm9zcy5pbm5lcicpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsZy5vcGVuUG9wVXAodCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbGcuZml4Qm9keSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGxnLmRpc2FibGVTY3JvbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJCgnLmNyb3NzJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHBsZy5jbG9zZVBvcFVwKCgnLnBvcC11cCcpKTtcbiAgICAgICAgICAgICAgICAkKCcuY3Jvc3MnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgcGxnLnVuZml4Qm9keSgpO1xuICAgICAgICAgICAgICAgIHBsZy5lbmFibGVTY3JvbGwoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdFN0aWNreUhlYWRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSAkKCcjc3RpY2t5LWhlYWRlcicpO1xuXG4gICAgICAgICAgICB2YXIgY29udHJvbGxlciA9IG5ldyBTY3JvbGxNYWdpYy5Db250cm9sbGVyKHtcbiAgICAgICAgICAgICAgICBnbG9iYWxTY2VuZU9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlckhvb2s6ICdvbkxlYXZlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBidWlsZCBzY2VuZVxuICAgICAgICAgICAgdmFyIHNjZW5lID0gbmV3IFNjcm9sbE1hZ2ljLlNjZW5lKHtcbiAgICAgICAgICAgICAgICB0cmlnZ2VyRWxlbWVudDogXCIjaW5pdFN0aWNreVwiLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hZGRUbyhjb250cm9sbGVyKVxuICAgICAgICAgICAgICAgIC5vbihcImVudGVyXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5jb250cm9sbGVyKCkuaW5mbyhcInNjcm9sbERpcmVjdGlvblwiKSA9PT0gXCJGT1JXQVJEXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuZmFkZUluKDMwMCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmZhZGVPdXQoMzAwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdEhpZGRlbkdhbGxlcnk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gJCgnYS5zaG93LW1vcmUnKSxcbiAgICAgICAgICAgICAgICBoaWRkZW5JbWFnZXMgPSAkKCcuY29sLWhpZGRlbicpLFxuICAgICAgICAgICAgICAgIGNsaWNrcyA9IDA7XG4gICAgICAgICAgICB0Lm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBoaWRkZW5JbWFnZXMudG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgKytjbGlja3MgJSAyID8gJCh0aGlzKS50ZXh0KFwi0KHQutGA0YvRgtGMXCIpLmFkZENsYXNzKCdvcGVuZWQnKSA6ICQodGhpcykudGV4dChcItCR0L7Qu9GM0YjQtVwiKS5yZW1vdmVDbGFzcygnb3BlbmVkJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0U2Nyb2xsZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gJCgnLnNjcm9sbCcpLFxuICAgICAgICAgICAgICAgIHNjcm9sbFRvLFxuICAgICAgICAgICAgICAgIHBsZyA9IHRoaXM7XG4gICAgICAgICAgICB0Lm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgc2Nyb2xsVG8gPSAkKGUudGFyZ2V0KS5kYXRhKCdzY3JvbC10bycpXG4gICAgICAgICAgICAgICAgaWYgKHNjcm9sbFRvID09PSBcInRvcFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHBsZy5zY3JvbGwoJ2JvZHknLCA1MDApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBsZy5zY3JvbGwoJy4nICsgc2Nyb2xsVG8sIDUwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0UGluczogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIga2V5cyA9IHsgMzc6IDEsIDM4OiAxLCAzOTogMSwgNDA6IDEgfTtcblxuICAgICAgICAgICAgdmFyIHNsaWRlciA9IHRoaXMudmVydGljYWxTd2lwZXIsXG4gICAgICAgICAgICAgICAgcGxnID0gdGhpcyxcbiAgICAgICAgICAgICAgICBtdWx0aXBsaWVyID0gMSxcbiAgICAgICAgICAgICAgICBzdGVwID0gMy41LFxuICAgICAgICAgICAgICAgIHByb2dyZXNzLFxuICAgICAgICAgICAgICAgIG9mZnNldCA9IDEwMCxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDQyMDAsXG4gICAgICAgICAgICAgICAgY2FuU2Nyb2xsID0gdHJ1ZSxcbiAgICAgICAgICAgICAgICBtZWRpYTE0NDAgPSB0aGlzLmNoZWNrTWVkaWEoXCIobWluLXdpZHRoOiAxNDQwcHgpXCIpO1xuICAgICAgICAgICAgbWVkaWExMDI0ID0gdGhpcy5jaGVja01lZGlhKFwiKG1pbi13aWR0aDogMTAyNHB4KSBhbmQgKG1heC13aWR0aDogMTQzOXB4KVwiKTtcbiAgICAgICAgICAgIHRhYmxldCA9IHRoaXMuY2hlY2tNZWRpYShcIihtaW4td2lkdGg6IDc2OHB4KSBhbmQgKG1heC13aWR0aDogMTAyM3B4KVwiKTtcbiAgICAgICAgICAgIG1vYmlsZSA9IHRoaXMuY2hlY2tNZWRpYShcIihtaW4td2lkdGg6IDMyMHB4KSBhbmQgKG1heC13aWR0aDogNzY3cHgpXCIpO1xuXG4gICAgICAgICAgICB2YXIgY29udHJvbGxlciA9IG5ldyBTY3JvbGxNYWdpYy5Db250cm9sbGVyKHtcbiAgICAgICAgICAgICAgICBnbG9iYWxTY2VuZU9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlckhvb2s6ICdvbkxlYXZlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAobWVkaWExNDQwIHx8IHRhYmxldCkge1xuICAgICAgICAgICAgICAgIG9mZnNldCA9IDEwMDtcbiAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDIyMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWVkaWExMDI0KSB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gMTIwO1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uID0gMjIwMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFtb2JpbGUpIHtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRlbGF5KCkge1xuICAgICAgICAgICAgICAgICAgICBwbGcuZml4Qm9keSgpO1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsZy51bmZpeEJvZHkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlci51bmxvY2tTd2lwZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgNTAwKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEFkZCBvbmUgbW9yZSBoYW5kbGVyIGZvciB0aGlzIGV2ZW50XG4gICAgICAgICAgICAgICAgc2xpZGVyLm9uKCdvblNsaWRlQ2hhbmdlRW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzbGlkZXIubG9ja1N3aXBlcygpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gYnVpbGQgc2NlbmVcbiAgICAgICAgICAgICAgICB2YXIgc2NlbmUgPSBuZXcgU2Nyb2xsTWFnaWMuU2NlbmUoe1xuICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyRWxlbWVudDogXCIjcGluXCIsXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiAtb2Zmc2V0XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmFkZFRvKGNvbnRyb2xsZXIpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRQaW4oXCIjcGluXCIpXG4gICAgICAgICAgICAgICAgICAgIC5vbihcImVudGVyXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuY29udHJvbGxlcigpLmluZm8oXCJzY3JvbGxEaXJlY3Rpb25cIikgPT09IFwiRk9SV0FSRFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGllciA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxpZXIgPSAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAub24oXCJwcm9ncmVzc1wiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3MgPSAxMCAqIGUucHJvZ3Jlc3MudG9GaXhlZCgyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5jb250cm9sbGVyKCkuaW5mbyhcInNjcm9sbERpcmVjdGlvblwiKSA9PT0gXCJGT1JXQVJEXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvZ3Jlc3MgPiBzdGVwICogbXVsdGlwbGllcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXIuc2xpZGVOZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxpZXIrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9ncmVzcyA8IHN0ZXAgKiBtdWx0aXBsaWVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlci5zbGlkZVByZXYoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGllci0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBwcmVsb2FkZXI6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIG92cmwgPSAkKFwiLnByZWxvYWRlclwiKSxcbiAgICAgICAgICAgICAgICBpbWcgPSAkKCdpbWcnKSxcbiAgICAgICAgICAgICAgICBzdGF0dXMgPSAkKFwiLnByZWxvYWRlci1zdGF0dXNcIiksXG4gICAgICAgICAgICAgICAgYyA9IDAsXG4gICAgICAgICAgICAgICAgdG90ID0gaW1nLmxlbmd0aDtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaW1nTG9hZGVkKCkge1xuICAgICAgICAgICAgICAgIGMgKz0gMTtcbiAgICAgICAgICAgICAgICB2YXIgcGVyYyA9ICgoMTAwIC8gdG90ICogYykgPDwgMCkgKyBcIiVcIjtcbiAgICAgICAgICAgICAgICBzdGF0dXMuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHBlcmNcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIGlmIChjID09PSB0b3QpIHJldHVybiBkb25lTG9hZGluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBkb25lTG9hZGluZygpIHtcbiAgICAgICAgICAgICAgICAkKFwiLnByZWxvYWRlclwiKS5hZGRDbGFzcyhcInpvb21PdXRcIik7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICQoXCIucHJlbG9hZGVyXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzSW1hZ2VMb2FkKCkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdG90OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRJbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgdEltZy5vbmxvYWQgPSBpbWdMb2FkZWQ7XG4gICAgICAgICAgICAgICAgICAgIHRJbWcub25lcnJvciA9IGltZ0xvYWRlZDtcbiAgICAgICAgICAgICAgICAgICAgdEltZy5zcmMgPSBpbWdbaV0uc3JjO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHByb2Nlc3NJbWFnZUxvYWQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0QWxsUGx1Z2luczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5pbml0U3dpcGVycygpO1xuICAgICAgICAgICAgdGhpcy5pbml0VGFicygpO1xuICAgICAgICAgICAgdGhpcy5pbml0UG9wVXBzKCk7XG4gICAgICAgICAgICB0aGlzLmluaXRIaWRkZW5HYWxsZXJ5KCk7XG4gICAgICAgICAgICB0aGlzLmluaXRTY3JvbGxlcigpO1xuICAgICAgICAgICAgdGhpcy5pbml0U3RpY2t5SGVhZGVyKCk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBicmVkZWsuaW5pdCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgc2VsZi5pbml0QWxsUGx1Z2lucygpO1xuICAgIH1cblxuICAgIGJyZWRlay5pbml0LnByb3RvdHlwZSA9IGJyZWRlay5wcm90b3R5cGU7XG4gICAgZ2xvYmFsLmJyZWRlayA9IGdsb2JhbC5CUkVERUsgPSBicmVkZWs7XG5cbn0od2luZG93LCBqUXVlcnkpKTtcblxuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHBsZyA9IEJSRURFSygpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBwbGcucHJlbG9hZGVyKCksIGZhbHNlKTtcbiAgICBwbGcuaW5pdFBpbnMoKTtcbn0pO1xuXG5cblxuXG5cbiJdfQ==
